<?php session_start();
include "connection/connect.php";
$adminRole = isset($_SESSION['admin_name'])?$_SESSION['admin_name']:"";
$id = $_GET['id'];
if(isset($_POST['submit'])){
	$sql="UPDATE toa_tot_calendar SET title='".$_POST['txttitle']."',start_date='".$_POST['txtstart']."',end_date='".$_POST['txtend']."',state_id='".$_POST['txtstate']."',city_id='".$_POST['txtcity']."',adress='".$_POST['txtaddress']."',batch_type='".$_POST['batch_type']."',fees='".$_POST['txtfee']."',jobrole_id='".$_POST['txtjobrole']."',batch_id='".$_POST['txtbatchid']."',batch_id_sip='".$_POST['txtbatchidsip']."',status='".$_POST['txtstatus']."',post_date=now() WHERE calendar_id='".$id."'";
	$exe = mysqli_query($mysqli,$sql);
	header('Location:insert_calender.php?upd');
	}
	$viewSecQry = "SELECT * FROM toa_tot_calendar where calendar_id='".$id."'";
	$exeSecQry = mysqli_query($mysqli,$viewSecQry);
	$row = mysqli_fetch_array($exeSecQry);
	$calendar_id= $row['calendar_id'];
	$title= $row['title'];
	$annoc_date= $row['batch_type'];
	$start_date= $row['start_date'];
	$end_date= $row['end_date'];
	$state_id= $row['state_id'];
	$city_id= $row['city_id'];
	$jobrole = "SELECT * FROM jobrole";
	$qurjobrole = mysqli_query($mysqli,$jobrole);
	$jobroleList="";
	while($arresjobrole = mysqli_fetch_assoc($qurjobrole)){ 
	$jobroleList .= "<option value='{$arresjobrole['jobrole_id']}'>{$arresjobrole['jobrole_name']}</option>";
	}
	$state = "SELECT * FROM states";
	$qurstate = mysqli_query($mysqli,$state);
	$stateList=""; 
	while($arresstate = mysqli_fetch_assoc($qurstate)){ 
	$stateList .= "<option value='{$arresstate['id']}'>{$arresstate['name']}</option>";
	}if(isset($_REQUEST['get']))    { 
		switch($_REQUEST['get'])        { 
			case 'cities':            { 
			$sql = "SELECT * FROM cities WHERE state_id = '".$_POST['sid']."'";
			$exe = mysqli_query($mysqli,$sql);
			$sel="";      
			while($arr = mysqli_fetch_array($exe))                {  
			if($arr['id']==$_POST['cid']){$sel="selected";} echo "<option value='{$arr['id']}' $sel>{$arr['name']}</option>";      
            }     
			}     
			die;            break;   
			}
			}
			if($adminRole !=""){?><!DOCTYPE html><html lang="en">  <head>	<?php include("include/header.php");?>  <link rel="stylesheet" href="css/froala_editor.css">  <link href="vendors/bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.css" rel="stylesheet">  </head>  <body class="nav-md">    <div class="container body">      <div class="main_container">	          <?php include("include/left-menu.php");?>        <!-- top navigation -->        		<?php include("include/top_nav.php");?>	        <!-- page content -->        <div class="right_col" role="main">          <div class="">            <div class="page-title">              <div class="title_left">                              </div>            </div>            <div class="clearfix"></div>              <?php              		              		if(isset($_GET['upd']))              		{              			echo " <div class='alert alert-success alert-dismissible fade in' role='alert'>                                  <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>×</span>                                  </button>                                  <strong>Banner has been Updated successfully</strong>                                </div>";              		}              		              		              		              		if(isset($_GET['ins']))              		{              			echo " <div class='alert alert-success alert-dismissible fade in' role='alert'>                                  <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>×</span>                                  </button>                                  <strong>Banner has been inserted Successfully</strong>                                </div>";              		}              	                	  if(isset($_GET['npdel']))              	  {              		echo " <div class='alert alert-danger alert-dismissible fade in' role='alert'>                                  <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>×</span>                                  </button>                                  <strong>It can't be deleted.This Product is linked.</strong>                                </div>";                    }              	                	  if(isset($_GET['del']))              	  {              		echo " <div class='alert alert-danger alert-dismissible fade in' role='alert'>                                  <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>×</span>                                  </button>                                  <strong>Banner has been Deleted Successfully</strong>                                </div>";                    }              		              		                   	              	              ?>            <div class="row">              <div class="col-md-12 col-sm-12 col-xs-12">                <div class="x_panel">                  <div class="x_title">                    <h2>Insert Calendar <small>Add calendar in IPSC Website</small></h2>                    <ul class="nav navbar-right panel_toolbox">                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>                      </li>                                           <li><a class="close-link"><i class="fa fa-close"></i></a>                      </li>                    </ul>                    <div class="clearfix"></div>                  </div>                                   <div class="x_content">                   <form id="basicForm" class="form-horizontal" method="post" enctype="multipart/form-data">          <div class="form-layout form-layout-1">            <div class="row mg-b-25">              <div class="col-lg-12">                <div class="form-group">                  <label class="form-control-label">TOT/TOA Title: <span class="tx-danger" style="font-size: 11px; color: red;">*</span></label>                  <input type="text" name="txttitle" class="form-control required" required="" value='<?php echo $title; ?>'>                </div>              </div><!-- col-4 -->              <div class="col-lg-4">                  <div class="form-group">                      <label>Job role: <span class="tx-danger" style="font-size: 11px; color: red;">*</span></label>                          <select class="form-control" name="txtjobrole" required=""  id="jobrole">                            <option value="">--Select--</option>                            <?php echo $jobroleList; ?>                          </select>                      </div>              </div>                <div class="col-lg-4">                   <div class="form-group">                  <label class="form-control-label">Start Date: <span class="tx-danger" style="font-size: 11px; color: red;">*</span></label>                      <div class="input-group date" id="myDatepicker1">                            <input type="text" name="txtstart" class="form-control" readonly="readonly" required="" value='<?php echo $start_date; ?>'>                            <span class="input-group-addon">                               <span class="glyphicon glyphicon-calendar"></span>                            </span>                        </div>                                  </div>              </div>                <div class="col-lg-4">                  <div class="form-group">                    <label>End Date:</label>                        <div class="input-group date" id="myDatepicker2">                            <input type="text" class="form-control" name="txtend" readonly="readonly" required="" value='<?php echo $end_date; ?>'>                            <span class="input-group-addon">                               <span class="glyphicon glyphicon-calendar"></span>                            </span>                        </div>                    </div>              </div>			       <div class="col-lg-2">               <div class="form-group">                    <label>State: <span class="tx-danger" style="font-size: 11px; color: red;">*</span></label>                       <select class="form-control" id="state" required="" name="txtstate">                         <option value="">--Select--</option>                         <?php echo $stateList; ?>                       </select>                    </div>              </div>			                    <div class="col-lg-2">               <div class="form-group">                    <label>City: <span class="tx-danger" style="font-size: 11px; color: red;">*</span></label>                          <select class="form-control" name="txtcity" id="district" required="">                           <option value="">--Select--</option>                         </select>                    </div>              </div>                <div class="col-lg-8">                <div class="form-group">                  <label class="form-control-label">Location/Address: <span class="tx-danger" style="font-size: 11px; color: red;">*</span></label>                  <input type="text" name="txtaddress" class="form-control required" onKeyPress="return onlyAlphabets(event,this);" required="" value='<?php echo $row['adress']; ?>' />                </div>              </div><!-- col-4 -->              <div class="col-lg-4">                 <div class="form-group">                    <label>Batch Type: <span class="tx-danger" style="font-size: 11px; color: red;">*</span></label>                          <select class="form-control" required="" name="batch_type" id="batch_type">                           <option value="">--Select--</option>                           <option value="New Trainers">New Trainers</option>                           <option value="Existing Trainers">Existing Trainers</option>                         </select>                    </div>              </div>              <div class="col-lg-4">                <div class="form-group">                    <label>Batch ID: <span class="tx-danger" style="font-size: 11px; color: red;">*</span></label>                        <input type="text" name="txtbatchid" class="form-control" value='<?php echo $row['batch_id']; ?>' >                    </div>              </div>               <div class="col-lg-4"> <div class="form-group">                    <label>Batch ID on SIP: <span class="tx-danger" style="font-size: 11px; color: red;">*</span></label>                        <input type="text" name="txtbatchidsip" class="form-control" value='<?php echo $row['batch_id_sip']; ?>' >                    </div>              </div>            <div class="col-lg-4">                <div class="form-group">                    <label>Fees: <span class="tx-danger" style="font-size: 11px; color: red;">*</span></label>                       <input type="text" name="txtfee" class="form-control" value='<?php echo $row['fees']; ?>' >                    </div>            </div>            <div class="col-lg-4">                <div class="form-group">                    <label>Status: <span class="tx-danger" style="font-size: 11px; color: red;">*</span></label>                        <select class="form-control" name="txtstatus" required="" id="sts">                          <option value="">--Select--</option>                          <option value="Created">Created</option>                          <option value="Completed">Completed</option>                        </select>                    </div>              </div>             </div><!-- row -->            <div class="row">               <div class="col-lg-4" style="margin-top:10px;">                <div class="form-group">                  <button class="btn btn-primary" name="submit">Update</button>                </div>              </div><!-- col-4 -->            </div>                     </div><!-- form-layout -->		  </form>                  </div>                </div>              </div>            </div>											   			          </div>        </div>        <!-- /page content -->			    <!-- footer content -->    <?php include("include/footer.php");?>        <!-- bootstrap-daterangepicker -->    <script src="vendors/moment/min/moment.min.js"></script>    <!-- bootstrap-datetimepicker -->        <script src="vendors/bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>    <script type="text/javascript">      $('#myDatepicker1,#myDatepicker2').datetimepicker({        ignoreReadonly: true,        allowInputToggle: true,        format: 'YYYY-MM-DD HH:mm A'    });    </script>        <script type="text/javascript">          $("#state").change(function(){          var sid = $(this).val();          var cid = <?php echo $row['city_id']?>;          $.post("update_calender.php", {get:"cities",sid:sid,cid:cid},function(data){            $("#district").empty();            $("#district").prepend("<option value='' selected='selected'>--Select--</option>");            $("#district").append(data);        });    });        </script>      <script type="text/javascript">       $(document).ready(function(){          $("#state option").filter(function() { return this.value == '<?php echo $row['state_id']; ?>' }).prop('selected', true);          $("#state").change();          $("#sts option").filter(function() { return this.value == '<?php echo $row['status']?>' }).prop('selected', true);          $("#jobrole option").filter(function() { return this.value == '<?php echo $row['jobrole_id']?>' }).prop('selected', true);          $("#batch_type option").filter(function() { return this.value == '<?php echo $row['batch_type']?>' }).prop('selected', true);       });     </script>         </div>    </div>  </body></html><?php }else{ header('Location:index.php');}?>